import{_ as s,o as a,c as n,S as p}from"./chunks/framework.662a2917.js";const i=JSON.parse('{"title":"OpenFGA Check","description":"","frontmatter":{},"headers":[],"relativePath":"reference/server/middlewares/openfga_check.md","filePath":"reference/server/middlewares/openfga_check.md"}'),e={name:"reference/server/middlewares/openfga_check.md"},l=p(`<h1 id="openfga-check" tabindex="-1">OpenFGA Check <a class="header-anchor" href="#openfga-check" aria-label="Permalink to &quot;OpenFGA Check&quot;">â€‹</a></h1><p>This middleware is used to check if the user has the right to access the resource with OpenFGA&#39;s API.</p><p>In here, we get the preferred_username from the token and it will get the user_id from our custom openfga&#39;s middleware API. Then it will call API with method as resource and name of the api&#39;s service.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">middlewares</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">openfga_check</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">openfga_check</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">openfga_check_api</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:8082/openfga/api/openfga/stores/&lt;store_id&gt;/check</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">openfga_user_api</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:8082/openfga/api/user</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">openfga_model_id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&lt;model_id&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">database</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">postgres</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">postgres://postgres:password@localhost:5432/postgres?sslmode=disable&amp;search_path=openfga</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">operation</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">api_name_rgx</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^/([^/]*)/([^/]*)/?(.*)$</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">api_name_replacement</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">$2</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">default_user_claim</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">preferred_username</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">connect</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">trace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">get</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">viewer</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">post</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">editor</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">put</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">editor</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">patch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">editor</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">delete</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">editor</span></span></code></pre></div><blockquote><p>Check the example of openfga_check.</p></blockquote>`,5),o=[l];function t(c,r,D,y,C,F){return a(),n("div",null,o)}const d=s(e,[["render",t]]);export{i as __pageData,d as default};
